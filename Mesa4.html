<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velada Romántica</title>
    <style>
        .seat {
            width: 60px;
            height: 60px;
            border: 2px solid #ccc;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
        }
        .available { background-color: #fff; }
        .occupied { background-color: #333; color: #fff; cursor: not-allowed; }
        .selected { background-color: #00ced1; }
    </style>
</head>
<body>
    <h1>Selecciona tus asientos</h1>
    <div id="seating-chart"></div>

    <script type="module">
        // Importar Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAeSHr1HjyaLBaY-H47y0LleeG99w8dRcc",
            authDomain: "velada-255a6.firebaseapp.com",
            projectId: "velada-255a6",
            storageBucket: "velada-255a6.appspot.com",
            messagingSenderId: "604033105183",
            appId: "1:604033105183:web:1b80a81c207b25b3f9842a",
            measurementId: "G-7GZMGGX0W3"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Obtener el contenedor de los asientos
        const seatingChart = document.getElementById('seating-chart');
        const pageId = "mesa4"; // ID de la mesa en Firestore

        // Referencia a la mesa en Firestore
        const seatsRef = doc(db, "asientos", pageId);

        // Escuchar cambios en tiempo real
        onSnapshot(seatsRef, (snapshot) => {
            const savedSeats = snapshot.exists() ? snapshot.data() : {};

            // Limpiar contenido antes de renderizar
            seatingChart.innerHTML = ""; 

            for (let i = 1; i <= 8; i++) {
                let seat = document.createElement('div');
                seat.classList.add('seat');
                seat.textContent = i;

                // Verificar si el asiento está ocupado o disponible
                if (savedSeats[`asiento${i}`]) {
                    seat.classList.add('occupied');
                    seat.setAttribute('data-info', savedSeats[`asiento${i}`]);
                    seat.style.cursor = 'not-allowed';
                } else {
                    seat.classList.add('available');
                    seat.setAttribute('data-info', 'Disponible');
                }

                // Tooltip para mostrar información del asiento
                seat.title = seat.getAttribute('data-info');

                // Evento para seleccionar un asiento
                seat.addEventListener('click', function () {
                    if (seat.classList.contains('occupied')) {
                        alert(seat.getAttribute('data-info'));
                    } else {
                        seat.classList.toggle('selected');
                    }
                });

                // Evento para comprar asiento (doble clic)
                seat.addEventListener('dblclick', async function () {
                    let password = prompt("Introduce la clave de administrador");
                    if (password === "admin123") {
                        let newName = prompt("Introduce el nombre del comprador:", seat.getAttribute('data-info'));
                        if (newName) {
                            seat.setAttribute('data-info', `Comprado por: ${newName}`);
                            seat.title = `Comprado por: ${newName}`;
                            seat.classList.remove('available');
                            seat.classList.add('occupied');
                            seat.style.cursor = 'not-allowed';

                            // Guardar la información del asiento en Firestore
                            await setDoc(seatsRef, {
                                ...savedSeats,
                                [`asiento${i}`]: `Comprado por: ${newName}`
                            });
                        }
                    } else {
                        alert("Clave incorrecta");
                    }
                });

                seatingChart.appendChild(seat);
            }
        });
    </script>
</body>
</html>
